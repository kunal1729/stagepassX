<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Events | StagePassX</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
  <div class="bg-[#FFFFFF] h-screen flex">
    <!-- Sidebar -->
    <div class="flex flex-col shadow-lg md:w-[20%] w-full h-auto md:h-screen border-r gap-6 md:gap-12 p-6 md:p-12">
      <h1 class="text-black text-2xl md:text-4xl font-bold">StagePassX</h1>

      <nav class="flex flex-col gap-8" id="sidebarNav">
        <div class="flex gap-4 items-center">
          <svg class="w-8 h-8 text-[#414A4C]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <a href="yourEvents.html" class="nav-link text-[#414A4C] text-lg font-semibold hover:text-blue-500">Dashboard</a>
        </div>

        <div class="flex gap-4 items-center">
          <svg class="w-8 h-8 text-[#414A4C]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          <a href="venuepage.html" class="nav-link text-[#414A4C] text-lg font-semibold hover:text-blue-500">Venues</a>
        </div> 

        <div class="flex gap-4 items-center">
          <svg class="w-8 h-8 text-[#414A4C]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
          <a href="TicketTYpe.html" class="nav-link text-[#414A4C] text-lg font-semibold hover:text-blue-500">Ticket Types</a>  
        </div> 
      </nav>

      <!-- Logout Button -->
      <button 
        onclick="handleLogout()" 
        class="bg-red-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-red-600 transition">
        Logout
      </button>
    </div>

    <!-- Main Section -->
    <div class="w-[75%] h-full overflow-y-auto">
      <div class="flex w-full items-center justify-between border-b px-12 py-6">
        <h1 class="text-black text-2xl font-bold">Events</h1>
        <button 
          onclick="openAddEventForm()" 
          class="bg-blue-500 font-semibold text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
          + Add Event
        </button>
      </div>

      <div class="flex flex-col gap-4 p-12">
        <h1 class="text-black text-xl font-bold">All Events</h1>
        <table class="w-full border-collapse shadow-sm">
          <thead class="bg-blue-100">
            <tr>
              <th class="text-left p-4 text-[#414A4C] font-semibold">Event Name</th>
              <th class="text-left p-4 text-[#414A4C] font-semibold">Date</th>
              <th class="text-left p-4 text-[#414A4C] font-semibold">Category</th>
              <th class="text-left p-4 text-[#414A4C] font-semibold">Status</th>
              <th class="text-left p-4 text-[#414A4C] font-semibold">Action</th>
            </tr>
          </thead>
          <tbody id="eventTableBody">
            <tr>
              <td colspan="5" class="text-center text-gray-500 p-4">Loading events...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const BASE_URL = "http://localhost:9090/api/events";

    document.addEventListener("DOMContentLoaded", () => {
      const currentPage = window.location.pathname.split("/").pop();
      const links = document.querySelectorAll(".nav-link");

      links.forEach(link => {
        if (link.getAttribute("href") === currentPage) {
          link.classList.add("text-blue-600", "font-bold");
        }
      });

      fetchEvents();
    });

    // ðŸ§¾ Fetch Events
    async function fetchEvents() {
      const tableBody = document.getElementById("eventTableBody");
      tableBody.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 p-4">Loading events...</td></tr>`;

      try {
        const userId = JSON.parse(localStorage.getItem('data'))?.userId;
        const response = await axios.get(`${BASE_URL}/userId/${userId}`);
        const events = response.data;

        if (!events.length) {
          tableBody.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 p-4">No events available.</td></tr>`;
          return;
        }

        tableBody.innerHTML = "";
        events.forEach(event => {
          const formattedDate = new Date(event.eventDate).toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
          });
          const statusClass = getStatusClass(event.status);
          
          const row = `
            <tr class="border-b hover:bg-blue-50 transition-colors">
              <td class="p-4 text-[#414A4C]">${event.eventName}</td>
              <td class="p-4 text-[#414A4C]">${formattedDate}</td>
              <td class="p-4 text-[#414A4C]">${event.category}</td>
              <td class="p-4">
                <span class="px-3 py-1 rounded-full text-sm font-medium ${statusClass}">
                  ${event.status}
                </span>
              </td>
              <td class="p-4 flex gap-3">
                <button onclick="viewEvent(${event.eventId})" class="text-green-600 hover:text-green-800 font-semibold transition-colors">View</button>
                <button onclick="editEvent(${event.eventId})" class="text-blue-500 hover:text-blue-700 font-semibold transition-colors">Edit</button>
                <button onclick="deleteEvent(${event.eventId})" class="text-red-500 hover:text-red-700 font-semibold transition-colors">Delete</button>
              </td>
            </tr>`;
          tableBody.insertAdjacentHTML("beforeend", row);
        });
      } catch (error) {
        console.error('Error fetching events:', error);
        tableBody.innerHTML = `<tr><td colspan="5" class="text-center text-red-500 p-4">Error loading events</td></tr>`;
      }
    }

    // ðŸŽ¨ Status Badge
    function getStatusClass(status) {
      switch(status) {
        case 'UPCOMING': return 'bg-yellow-100 text-yellow-700';
        case 'ACTIVE': return 'bg-teal-100 text-teal-700';
        case 'COMPLETED': return 'bg-gray-100 text-gray-700';
        case 'CANCELLED': return 'bg-red-100 text-red-700';
        default: return 'bg-blue-100 text-blue-700';
      }
    }

    // ðŸšª Logout
    function handleLogout() {
      Swal.fire({
        title: "Are you sure?",
        text: "You will be logged out of your account.",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#ef4444",
        cancelButtonColor: "#6b7280",
        confirmButtonText: "Logout",
      }).then((result) => {
        if (result.isConfirmed) {
          localStorage.removeItem("data");
          Swal.fire({
            icon: "success",
            title: "Logged Out!",
            text: "You have been logged out successfully.",
            confirmButtonColor: "#3b82f6",
          }).then(() => {
            window.location.href = "login.html";
          });
        }
      });
    }
  </script>
</body>
</html>
